# telegram_githubell

Githubell íŒŒì´ì¬ ê¸°ë°˜ í…”ë ˆê·¸ë¨ ë´‡ì…ë‹ˆë‹¤!

## ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

### Step 1. ê°€ìƒí™˜ê²½ ìƒì„±í•˜ê¸°

### `python -m venv {ê°€ìƒí™˜ê²½ ì´ë¦„}`

í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ í†µí•´ í˜„ì¬ ìœ„ì¹˜í•œ ê²½ë¡œì— íŒŒì´ì¬ ê°€ìƒí™˜ê²½ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤\
í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ íŒŒì´ì¬ ë²„ì „ì€ 3.8ì…ë‹ˆë‹¤!

### mac/Linux ê°€ìƒ í™˜ê²½ ì‹¤í–‰ ëª…ë ¹ì–´

### `source {ê°€ìƒí™˜ê²½ì´ë¦„}/bin/activate {ê°€ìƒí™˜ê²½ì´ë¦„}`

### window ê°€ìƒ í™˜ê²½ ì‹¤í–‰ ëª…ë ¹ì–´

### `source {ê°€ìƒí™˜ê²½ì´ë¦„}/Script/activate {ê°€ìƒí™˜ê²½ì´ë¦„}`

### ê°€ìƒ í™˜ê²½ ì¢…ë£Œ ëª…ë ¹ì–´

### `deactivate`

### Step 2. pip install

### `pip install -r requirments.txt`

ê°€ìƒí™˜ê²½ì„ ì‹¤í–‰í•œ í›„ í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ í†µí•´ íŒ¨í‚¤ì§€ íŒŒì¼ì„ ëª¨ë‘ ì„¤ì¹˜í•˜ì„¸ìš”

### Step 3. ì„œë²„ ì‹¤í–‰í•˜ê¸°

### `python manage.py runserver`

í•´ë‹¹ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ í…”ë ˆê·¸ë¨ ë´‡ì´ ì‹¤í–‰ë©ë‹ˆë‹¤ :)\
ì•„ì§ Bot tokenì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìœ¼ë¯€ë¡œ ì‹¤í–‰í•˜ì§„ ë§ˆì„¸ìš”!

### Step 4. Bot í† í° ë„£ê¸°

api í´ë” ì†ì— env.py íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•˜ì„¸ìš”!

```
./api/env.py

def token():
    value = {Bot í† í°}
    return value
```

í•´ë‹¹ íŒŒì¼ì„ ë§Œë“¤ê³  ì„œë²„ë¥¼ ì‹¤í–‰í•´ì•¼ í…”ë ˆê·¸ë¨ ë´‡ì´ ì‹¤í–‰ë©ë‹ˆë‹¤ :)\

## Telegram Bot

ì¹´ì¹´ì˜¤í†¡ì˜ 'ì„ í†¡'ê¸°ëŠ¥ ì‚¬ìš© ë¶ˆê°€ ì´ìŠˆë¡œ ì¶”ê°€ëœ ë©”ì‹ ì € í”Œë«í¼ì…ë‹ˆë‹¤. \ì¹´ì¹´ì˜¤í†¡ ë´‡ì— ë¹„í•´ í° ì œì•½ì—†ì´ ì±—ë´‡ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìœ¼ë©° ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

## HOST SERVER - PythonAnywhere

PythonAnywhereëŠ” Djangoë¥¼ ìš´ì˜í•˜ëŠ”ë° ê°€ì¥ íš¨ìœ¨ì ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ì—¬ ì¤ë‹ˆë‹¤.
ëª‡ë²ˆì˜ ì¡°ì‘ìœ¼ë¡œ ì„œë²„ êµ¬ì„±ì„ í•´ì¤„ ë¿ ì•„ë‹ˆë¼ ì—¬ëŸ¬ê°€ì§€ ë°©ë©´ì—ì„œ ê°œë°œìë¥¼ ìœ„í•œ í¸ë¦¬í•œ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•˜ì—¬ ì¤ë‹ˆë‹¤

## ì†ŒìŠ¤ì½”ë“œ TREE

```
.
â”œâ”€â”€ Procfile
â”œâ”€â”€ README.md
â”œâ”€â”€ Telegram #ì €í¬ ë©”ì¸ ì•± ì´ë¦„ì…ë‹ˆë‹¤ :D
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ __pycache__
â”‚   â”‚   â”œâ”€â”€ __init__.cpython-39.pyc
â”‚   â”‚   â”œâ”€â”€ settings.cpython-39.pyc
â”‚   â”‚   â”œâ”€â”€ urls.cpython-39.pyc
â”‚   â”‚   â””â”€â”€ wsgi.cpython-39.pyc
â”‚   â”œâ”€â”€ asgi.py
â”‚   â”œâ”€â”€ settings.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ wsgi.py
â”œâ”€â”€ api #ì—¬ê¸°ì„œ ì €í¬ ë´‡ì´ ë™ì‘í•´ìš”~!
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ __pycache__
â”‚   â”œâ”€â”€ admin.py
â”‚   â”œâ”€â”€ apps.py
â”‚   â”œâ”€â”€ getGithub.py #ê¹ƒí—ˆë¸Œì—ì„œ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤
â”‚   â”œâ”€â”€ migrations
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ tests.py
â”‚   â”œâ”€â”€ urls.py
â”‚   â””â”€â”€ views.py #í•´ë‹¹ íŒŒì¼ì—ì„œ ë´‡ì´ ë™ì‘í•¨!
â”œâ”€â”€ db.sqlite3
â”œâ”€â”€ manage.py #ë©”ì¸ ì‹¤í–‰ íŒŒì¼
â”œâ”€â”€ myvenv #ê°€ìƒí™˜ê²½ì„ ì €ì¥í•˜ëŠ” í´ë”
â”œâ”€â”€ requirements.txt #íŒ¨í‚¤ì§€ í†µí•© ì„¤ì¹˜ íŒŒì¼
â”œâ”€â”€ runtime.txt
â”œâ”€â”€ static
â”‚   â””â”€â”€ no
â””â”€â”€ staticfiles
```

# BACK-END API

ì´ APIëŠ” POST ë° GET ìš”ì²­ì„ ì‚¬ìš© í•˜ì—¬ í†µì‹ í•˜ê³  HTTP ì‘ë‹µ ì½”ë“œ ë¥¼ ì‚¬ìš© í•˜ì—¬ ìƒíƒœ ë° ì˜¤ë¥˜ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. ëª¨ë“  ì‘ë‹µì€ í‘œì¤€ JSONìœ¼ë¡œ ì œê³µë©ë‹ˆë‹¤.
ëª¨ë“  ìš”ì²­ì—ëŠ” content-typeof ê°€ í¬í•¨ë©ë‹ˆë‹¤ application/json ë˜ì–´ì•¼í•˜ë©° ë³¸ë¬¸ì€ ìœ íš¨í•œ JSONì´ì–´ì•¼í•©ë‹ˆë‹¤.

## Bot ì‹¤í–‰ ì½”ë“œ

```
./api/views.py
import logging
from django.shortcuts import render
import telegram
from rest_framework.views import APIView
from rest_framework.response import Response
from telegram import InlineKeyboardButton, InlineKeyboardMarkup
from telegram import Update
from telegram.ext import Updater, CommandHandler, ConversationHandler, CallbackQueryHandler, MessageHandler, Filters, CallbackContext
# from telegram import InlineKeyboardButton, InlineKeyboardMarkup, Update
from django.http import HttpResponse
import requests
import json
from urllib.request import urlopen
import re
from . import getGithub
from . import env

logging.basicConfig(format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
                    level=logging.INFO)
logger = logging.getLogger(__name__)
p = re.compile('\$branch_*(.*)')
a = re.compile('\$Alias_*(.*)')
c = re.compile('\$Check_*(.*)')

BRANCH, ALIAS, TYPING, SEND, STATUS, CHOOSE = range(6)
TOKEN = env.token()
bot = telegram.Bot(token=TOKEN)


class UserAlarm (APIView):
    def get(self, request):
        try:
           print('bot on')
           #nothing to do...
        except Exception as e:
            return e

#í•µì‹¬ì½”ë“œ
custom_keyboard = [['ì‚¬ìš©ë°©ë²•'], ['ë ˆí¬ì§€í† ë¦¬ ìƒíƒœ í™•ì¸'], ['ì‘ë³„ì¸ì‚¬']]
reply_markup = telegram.ReplyKeyboardMarkup(
    custom_keyboard, one_time_keyboard=False)


def start(update: Update, context: CallbackContext) -> None:  # ì‹œì‘í•  ë•Œ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜]
    update.message.reply_text("ì•ˆë…•!, ë‚œ ê¹ƒí—ˆë²¨ì´ì•¼ :D", reply_markup=reply_markup)

    try:
        user = update.message.from_user
        id = context.args[0]
        update.message.reply_text('ì•—! ìƒˆë¡œìš´ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë“±ë¡í•˜ë ¤ê³ í•˜ëŠ”êµ¬ë‚˜?')
        owner, repo = getGithub.urlGet(id)
        data = getGithub.bracnhGet(owner, repo)
        update.message.reply_text(data['name'] + ' ë ˆí¬ì§€í† ë¦¬ ë§ì§€?')
        context.user_data[0] = user.id  # í…”ë ˆê·¸ë¨ ì±„íŒ… ì•„ì´ë””
        context.user_data[1] = data['name']  # ë ˆí¬ì§€í† ë¦¬ ì´ë¦„
        # 2ë²ˆì€ ì„ íƒí•œ ë¸Œëœì¹˜
        context.user_data[3] = data['name']  # ë ˆí¬ì§€í† ë¦¬ ë³„ëª…
        # ë ˆí¬ì§€í† ë¦¬ ì£¼ì†Œ
        context.user_data[4] = f'https://github.com/{owner}/{repo}'
        update.message.reply_text('ë“±ë¡ì„ ìœ„í•´ ëª‡ê°€ì§€ ì ˆì°¨ê°€ í•„ìš”í•´!')
        branchList = []
        for i in data['branch_lists']:
            branchList.append([InlineKeyboardButton(
                text=f"{i}", callback_data=f"$branch_"+i)])
        branchList.append([InlineKeyboardButton(
            text="ê·¸ë§Œë‘ê¸°", callback_data="END")])
        brMarkup = InlineKeyboardMarkup(branchList)

        update.message.reply_text(
            'ë¨¼ì € ë¸Œëœì¹˜ë¥¼ ê³¨ë¼ì¤˜!', reply_markup=brMarkup)
        # update.message.reply_text("ë¨¼ì € ë¸Œëœì¹˜ë¥¼ ê³¨ë¼ì¤„ë˜?", reply_markup=brMarkup)
        return BRANCH

    except(IndexError, ValueError):
        update.message.reply_text(
            'https://githubell.netlify.app/ ì—ì„œ ê¹ƒí—ˆë¸Œ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë“±ë¡í• ìˆ˜ìˆì–´!')
        update.message.reply_text(
            '/start ëª…ë ¹ì–´ë¡œ ì–¸ì œë“ ì§€ ë‚  ë¶ˆëŸ¬ì¤˜!')
        return CHOOSE


# ë¸Œëœì¹˜ ì„ íƒì— ëŒ€í•œ ëŒ€ë‹µ (BRANCH)


def branch(update: Update, context: CallbackContext) -> None:
    query = update.callback_query
    data = p.match(query.data).group(1)
    query.answer()
    bot.send_message(chat_id=query.message.chat_id, text=f'{data} ë¸Œëœì¹˜ë¥¼ ê³¨ëêµ¬ë‚˜?')
    context.user_data[2] = data
    # print(context.user_data)
    text = "ì´ì œ ë³„ëª…ì„ ì…ë ¥í•´ì¤˜!"
    bot.send_message(chat_id=query.message.chat_id, text=text)
    bot.send_message(chat_id=query.message.chat_id,
                     text='/skip ì„ ì¹˜ë©´ ë³„ëª… ì„¤ì •ì€ ìƒëµë ê±°ì•¼!')

    return TYPING


def skip_alias(update: Update, context: CallbackContext) -> None:
    bot.send_message(chat_id=update.message.chat.id,
                     text=f'ì•Œê² ì–´! ê¸°ë³¸ ë ˆí¬ì§€í† ë¦¬ ì´ë¦„ì¸ {context.user_data[1]}ìœ¼ë¡œ ë“±ë¡í•´ë‘˜ê²Œ!')
    keyboard = [
        [
            InlineKeyboardButton("ë°ì´í„° ë³´ë‚´ê¸°", callback_data='SEND'),
            InlineKeyboardButton("ì·¨ì†Œ", callback_data='END'),
        ]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    bot.send_message(chat_id=update.message.chat.id,
                     text="ì´ì œ ë°ì´í„° ë³´ë‚´ê¸°ë¥¼ ëˆŒëŸ¬ì„œ ìµœì¢…ì ìœ¼ë¡œ ë“±ë¡í•´ì¤˜!", reply_markup=reply_markup
                     )
    return SEND


def saveAlias(update: Update, context: CallbackContext):
    query = update.callback_query
    context.user_data[3] = update.message.text
    bot.send_message(chat_id=update.message.chat.id,
                     text=f'{context.user_data[3]} ë¼ëŠ” ë³„ëª…ìœ¼ë¡œ ë“±ë¡í•´ë‘˜ê²Œ!')
    keyboard = [
        [
            InlineKeyboardButton("ë°ì´í„° ë³´ë‚´ê¸°", callback_data='SEND'),
            InlineKeyboardButton("ì·¨ì†Œ", callback_data='END'),
        ]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)
    bot.send_message(chat_id=update.message.chat.id,
                     text="ì´ì œ ë°ì´í„° ë³´ë‚´ê¸°ë¥¼ ëˆŒëŸ¬ì„œ ìµœì¢…ì ìœ¼ë¡œ ë“±ë¡í•´ì¤˜!", reply_markup=reply_markup
                     )
    # user_data[START_OVER] = True
    return SEND


def send(update: Update, context: CallbackContext) -> None:
    query = update.callback_query
    query.answer()
    send_data = {'id': context.user_data[0],  # ìœ ì € ì•„ì´ë””
                 'fav_repository': context.user_data[4],  # ë ˆí¬ì£¼ì†Œ
                 'nick_name': context.user_data[3],  # ë ˆí¬ ë³„ëª…
                 'type': 'telegram',
                 'branch': context.user_data[2]}  # ì„ íƒ ë¸Œëœì¹˜
    # print(send_data)
    response = requests.post(
        url='http://margarets.pythonanywhere.com/api/', data=send_data)
    # print(response)
    bot.send_message(chat_id=query.message.chat.id,
                     text=f'{context.user_data[3]} ë ˆí¬ì§€í† ë¦¬ê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ëì–´! ì´ì œ ìƒˆë¡œìš´ ì—…ë°ì´íŠ¸ê°€ ìƒê¸°ë©´ ë‚´ê°€ ì•Œë ¤ì¤„ê²Œ!')
    print(context.user_data)
    return CHOOSE


def repoStatus(update: Update, context: CallbackContext):  # ë ˆí¬ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì ¸ì™€ì„œ ê³ ë¥´ëŠ” í•¨ìˆ˜
    #print('active repoStatus')
    repoList = []
    res = requests.get(
        f"http://margarets.pythonanywhere.com/api/alias/?id={update.effective_chat.id}")
    res = json.loads(res.content)
    # print(update)
    resLength = len(res['alias'])
    if(len(res['alias']) == 0):
        update.message.reply_text("ì•„ì§ ë“±ë¡ëœ ë¸Œëœì¹˜ê°€ ì—†ëŠ”ê²ƒê°™ì•„...ğŸ˜¢")
        update.message.reply_text(
            "ğŸ”” https://githubell.netlify.app/ ì—ì„œ ê¹ƒí—ˆë¸Œ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë“±ë¡í• ìˆ˜ìˆì–´!")
        return CHOOSE
    else:
        for i in range(0, resLength):
            repoList.append([InlineKeyboardButton(
                text=f"{res['alias'][i]}", callback_data=f"$Check_{res['alias'][i]}")])
        repoMarkup = InlineKeyboardMarkup(repoList)
        update.message.reply_text("ì›í•˜ëŠ” ë ˆí¬ë³„ëª…ì„ ì„ íƒí•´ì¤„ë˜?", reply_markup=repoMarkup)
        return STATUS


def end(update: Update, context: CallbackContext) -> None:
    bot.send_message(chat_id=update.callback_query.message.chat.id,
                     text='ë ˆí¬ì§€í† ë¦¬ ë“±ë¡ì´ ì¤‘ë‹¨ë˜ì—ˆì–´:(')
    return CHOOSE


def farewell(update: Update, context: CallbackContext) -> None:
    bot.send_message(chat_id=update.message.chat.id,
                     text='ë„ˆë„ ì•ˆë…•!! ë‹¤ì‹œ ë‚´ê°€ í•„ìš”í•˜ë©´ /startë¡œ ë‚  ë¶ˆëŸ¬ì¤˜!')
    return ConversationHandler.END


def changeKST(ISO):  # ISO -> KST ì‹œê°„ ë³€í™˜
    yyyymmdd, time = ISO.split('T')
    yyyy, mm, dd = yyyymmdd.split('-')
    hour, minute, second = time.split(':')
    second, Z = second.split('Z')
    hour = int(hour)+9
    if hour >= 24:
        hour -= 24
    hour = str(hour)
    # KST = yyyy + "ë…„" + mm + "ì›”" + dd + "ì¼ " + hour + "ì‹œ" + minute + "ë¶„" + second + "ì´ˆ"
    KST = yyyymmdd + " " + hour + ":" + minute + ":" + second
    return KST


def callbackGet(update: Update, context: CallbackContext):  # ë ˆí¬ ì„ íƒì— ëŒ€í•œ ëŒ€ë‹µ
    data = {'id': f'{update.effective_chat.id}',
            'nick_name': f'{c.match(update.callback_query.data).group(1)}'}
    try:
        res = requests.get(
            "http://margarets.pythonanywhere.com/api/git/", params=data)
        res = json.loads(res.content)
        repoURL = res['repoUrl']
        repoBRANCH = res['repoBranch']
        data2 = {'id': f'{update.effective_chat.id}', 'nick_name': f'{c.match(update.callback_query.data).group(1)}',
                 'fav_repository': f'{repoURL}', 'type': 'telegram', 'branch': f'{repoBRANCH}'}
        res2 = requests.get(
            "http://margarets.pythonanywhere.com/api/", params=data2)
        res2 = json.loads(res2.content)

        if res2 == []:
            return_res2 = "í•´ë‹¹ ë ˆí¬ ì—…ë°ì´íŠ¸ ì‚¬í•­ì´ ì—†ë„¤..:d"
        elif res2 == None:
            return_res2 = "í•´ë‹¹ ë ˆí¬ ì—…ë°ì´íŠ¸ ì‚¬í•­ì´ ì—†ì–´..:("
        else:
            ISO = res2[0].get("commit").get("committer").get("date")
            KST = changeKST(ISO)
            return_res2 = f"[{update.callback_query.data}] ìµœê·¼ ì»¤ë°‹ ì´ë ¥ì´ì•¼!.\n"
            return_res2 = return_res2 + "ë‚ ì§œ : " + KST + "\n"
            return_res2 = return_res2 + "ì´ë¦„ : " + \
                res2[0].get("commit").get("committer").get("name") + "\n"
            return_res2 = return_res2 + "ì´ë©”ì¼ : " + \
                res2[0].get("commit").get("committer").get("email") + "\n"
            return_res2 = return_res2 + "ì»¤ë°‹ë©”ì„¸ì§€ : " + \
                res2[0].get("commit").get("message") + "\n"
            return_res2 = return_res2 + "ì£¼ì†Œ : " + res2[0].get("html_url")

        context.bot.edit_message_text(text=f"{return_res2}",
                                      chat_id=update.callback_query.message.chat_id,
                                      message_id=update.callback_query.message.message_id)
        return CHOOSE
    except IndexError:
        print(IndexError)
        bot.send_message(chat_id=update.message.chat.id,
                         text='ë¬´ìŠ¨ ë¬¸ì œê°€ ìƒê²¼ë‚˜ë´! ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì¤˜!')
        return CHOOSE


def howto(update: Update, context: CallbackContext):
    # print('ì‚¬ìš©ë°©ë²•')
    bot.send_message(chat_id=update.message.chat.id,
                     text='ê´€ì‹¬ìˆê±°ë‚˜ ì†Œì‹ë°›ê³ ì‹¶ì€ ë ˆí¬ì§€í† ë¦¬ê°€ ìˆë‹ˆ?')
    bot.send_message(chat_id=update.message.chat.id,
                     text='https://githubell.netlify.app/ ì—ì„œ ê¹ƒí—ˆë¸Œ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë“±ë¡í• ìˆ˜ìˆì–´!')
    bot.send_message(chat_id=update.message.chat.id,
                     text='ê¹ƒí—ˆë²¨ í™ˆí˜ì´ì§€ì—ì„œ ë§Œë“  íì•Œì½”ë“œë¥¼ ì¸ì‹ ì–´í”Œë¡œ ì¸ì‹ì‹œì¼œì£¼ë©´ ë‚´ê°€ ê¸°ì–µí•´ë‘˜ê²Œ!')
    return CHOOSE
# start_handler = CommandHandler('start', start, pass_args=True)
# repoStatus_handler = CommandHandler('check', repoStatus)

# dispatcher.add_handler(start_handler)
# dispatcher.add_handler(repoStatus_handler)


'''dispatcher.add_handler(CallbackQueryHandler(
    callbackBranchGet, pattern=p))
dispatcher.add_handler(CallbackQueryHandler(
    callbackAliasGet, pattern=a))
# dispatcher.add_handler(MessageHandler(Filters.text, GetAlias))'''

# url = f"https://api.telegram.org/bot{TOKEN}/getUpdates"
# bot = telegram.Bot(token=TOKEN)
#print('start main')
updater = Updater(token=TOKEN, use_context=True)

updater = Updater(TOKEN)

dispatcher = updater.dispatcher

conv_handler = ConversationHandler(
    entry_points=[CommandHandler('start', start)],
    states={
        BRANCH: [CallbackQueryHandler(branch, pattern=p)],
        ALIAS: [CallbackQueryHandler(saveAlias, pattern='^(?!\/skip).*$')],
        TYPING: [MessageHandler(Filters.text & ~Filters.command, saveAlias), CommandHandler('skip', skip_alias)],
        SEND: [CallbackQueryHandler(send, pattern='^SEND$')],
        STATUS: [(CallbackQueryHandler(callbackGet, pattern=c))],
        CHOOSE: [MessageHandler(Filters.regex('^(ì‚¬ìš©ë°©ë²•)$'), howto), MessageHandler(
            Filters.regex('^ë ˆí¬ì§€í† ë¦¬ ìƒíƒœ í™•ì¸$'), repoStatus), MessageHandler(
            Filters.regex('^ì‘ë³„ì¸ì‚¬$'), farewell)]
    },
    fallbacks=[CallbackQueryHandler(end, pattern='^END$')],

    per_user=True,
    conversation_timeout=3600,
)
dispatcher.add_handler(conv_handler)
# dispatcher.add_handler(CallbackQueryHandler(callbackGet, pattern=c))

updater.start_polling(timeout=10, poll_interval=1, clean=True)

```

## ìœ ì € ìƒˆ ë ˆí¬ì§€í† ë¦¬ ë“±ë¡ ìš”ì²­

ìœ ì €ê°€ ì„œë²„ì— ìƒˆ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë“±ë¡í•˜ëŠ” ìš”ì²­ì…ë‹ˆë‹¤

```json
POST "http://margarets.pythonanywhere.com/api/"
```

| íŒŒë¼ë¯¸í„°         |                ì˜ë¯¸                 |
| ---------------- | :---------------------------------: |
| `id`             |       ë“±ë¡ëœ ìœ ì € ì•„ì´ë”” ì •ë³´       |
| `fav_repository` | ë“±ë¡ëœ ìœ ì €ê°€ ê´€ì‹¬ë“±ë¡í•œ ë ˆíŒŒì§€í† ë¦¬ |
| `nick_name`      |        ìœ ì €ê°€ ë“±ë¡í•œ ë‹‰ë„¤ì„         |
| `type`           |              sns íƒ€ì…               |
| `branch`         |     ê´€ì‹¬ ë ˆíŒŒì§€í† ë¦¬ì˜ ë¸Œëœì¹˜ëª…      |

**ì„±ê³µì‹œ:**

```json
HTTP/1.1 200
Server: margarets.pythonanywhere.com
Content-Type: application/json
{
    "ì •ìƒì ìœ¼ë¡œ api í˜¸ì¶œ ì™„ë£Œ"
}
```

**ì‹¤íŒ¨ì‹œ:**

```json
HTTP/1.1 404
Server: margarets.pythonanywhere.com
Content-Type: application/json
{
    "ì •ìƒì ì´ì§€ ì•Šì€ {ë³€ìˆ˜ ì´ë¦„} ì…ë‹ˆë‹¤"
}
```

## ìœ ì €ê¸° ìš”ì²­í•œ ë‹‰ë„¤ì„ ë ˆí¬ì§€í† ë¦¬ì˜ ì‹¤ì œ ë ˆí¬ì§€í† ë¦¬ ì •ë³´ ìš”ì²­

ìœ ì €ê°€ ì €ì¥í•œ ë³„ëª… ë ˆí¬ì§€í† ë¦¬ì˜ ì‹¤ì œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ìš”ì²­ì…ë‹ˆë‹¤.\
ìƒˆë¡œìš´ ì •ë³´ê°€ ê°±ì‹ ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ê¸° ì „ì— ë¨¼ì € ì‹¤í–‰ë˜ëŠ” api ìš”ì²­í•¨ìˆ˜ì…ë‹ˆë‹¤

**ìš”ì²­:**

```json
GET "http://margarets.pythonanywhere.com/api/git/?id={id}&&nick_name={nick_name}}"
```

| íŒŒë¼ë¯¸í„°    |          ì˜ë¯¸           |
| ----------- | :---------------------: |
| `id`        | ë“±ë¡ëœ ìœ ì € ì•„ì´ë”” ì •ë³´ |
| `nick_name` |  ìœ ì €ê°€ ë“±ë¡í•œ ë‹‰ë„¤ì„   |

**ì„±ê³µì‹œ:**

```json
HTTP/1.1 200
Server: margarets.pythonanywhere.com
Content-Type: application/json
{
    "repoUrl": "https://github.com/margarets-kim/telegram_githubell",
    "repoBranch": "main"
}
```

**ì‹¤íŒ¨ì‹œ:**

```json
HTTP/1.1 200
Server: margarets.pythonanywhere.com
Content-Type: application/json
{
    "repoUrl": [], //ë¹ˆ ë°°ì—´ ë¦¬í„´
    "repoBranch": []
}
}
```

## ìœ ì € ë ˆí¬ì§€í† ë¦¬ ì €ì¥ ì •ë³´ ìš”ì²­

ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ì§€ ì•ì„œ ì‹¤ì œ ë ˆí¬ì§€í† ë¦¬ì˜ ì •ë³´ë¥¼ ë“¤ê³ ì˜¨ í›„ ê¸°ì¡´ DBì™€ ë¹„êµ ìš”ì²­ì„ í•˜ëŠ” api ìš”ì²­ í•¨ìˆ˜ì…ë‹ˆë‹¤

**ìš”ì²­:**

```json
GET "http://margarets.pythonanywhere.com/api/?{Params}"
```

| íŒŒë¼ë¯¸í„°         |                ì˜ë¯¸                 |
| ---------------- | :---------------------------------: |
| `id`             |       ë“±ë¡ëœ ìœ ì € ì•„ì´ë”” ì •ë³´       |
| `fav_repository` | ë“±ë¡ëœ ìœ ì €ê°€ ê´€ì‹¬ë“±ë¡í•œ ë ˆíŒŒì§€í† ë¦¬ |
| `nick_name`      |        ìœ ì €ê°€ ë“±ë¡í•œ ë‹‰ë„¤ì„         |
| `type`           |              sns íƒ€ì…               |
| `branch`         |     ê´€ì‹¬ ë ˆíŒŒì§€í† ë¦¬ì˜ ë¸Œëœì¹˜ëª…      |

**ì„±ê³µì‹œ:**

```json
HTTP/1.1 200
Server: margarets.pythonanywhere.com
Content-Type: application/json
[
    {
        "sha": "e26c844322f0f7b2b045484532c601f114384792",
        "node_id": "MDY6Q29tbWl0MzE5NDMxMjU1OmUyNmM4NDQzMjJmMGY3YjJiMDQ1NDg0NTMyYzYwMWYxMTQzODQ3OTI=",
        "commit": {
            "author": {
                "name": "margarets-kim",
                "email": "margarets.urssu@gmail.com",
                "date": "2020-12-08T18:04:57Z"
            },
            "committer": {
                "name": "margarets-kim",
                "email": "margarets.urssu@gmail.com",
                "date": "2020-12-08T18:04:57Z"
            },
            "message": "final",
            "tree": {
                "sha": "c8a13682a940e58da997992b935b715c8ae9a2a6",
                "url": "https://api.github.com/repos/margarets-kim/telegram_githubell/git/trees/c8a13682a940e58da997992b935b715c8ae9a2a6"
            },
            "url": "https://api.github.com/repos/margarets-kim/telegram_githubell/git/commits/e26c844322f0f7b2b045484532c601f114384792",
            "comment_count": 0,
            "verification": {
                "verified": false,
                "reason": "unsigned",
                "signature": null,
                "payload": null
            }
        },
        "url": "https://api.github.com/repos/margarets-kim/telegram_githubell/commits/e26c844322f0f7b2b045484532c601f114384792",
        "html_url": "https://github.com/margarets-kim/telegram_githubell/commit/e26c844322f0f7b2b045484532c601f114384792",
        "comments_url": "https://api.github.com/repos/margarets-kim/telegram_githubell/commits/e26c844322f0f7b2b045484532c601f114384792/comments",
        "author": {
            "login": "margarets-kim",
            "id": 71299486,
            "node_id": "MDQ6VXNlcjcxMjk5NDg2",
            "avatar_url": "https://avatars0.githubusercontent.com/u/71299486?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/margarets-kim",
            "html_url": "https://github.com/margarets-kim",
            "followers_url": "https://api.github.com/users/margarets-kim/followers",
            "following_url": "https://api.github.com/users/margarets-kim/following{/other_user}",
            "gists_url": "https://api.github.com/users/margarets-kim/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/margarets-kim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/margarets-kim/subscriptions",
            "organizations_url": "https://api.github.com/users/margarets-kim/orgs",
            "repos_url": "https://api.github.com/users/margarets-kim/repos",
            "events_url": "https://api.github.com/users/margarets-kim/events{/privacy}",
            "received_events_url": "https://api.github.com/users/margarets-kim/received_events",
            "type": "User",
            "site_admin": false
        },
        "committer": {
            "login": "margarets-kim",
            "id": 71299486,
            "node_id": "MDQ6VXNlcjcxMjk5NDg2",
            "avatar_url": "https://avatars0.githubusercontent.com/u/71299486?v=4",
            "gravatar_id": "",
            "url": "https://api.github.com/users/margarets-kim",
            "html_url": "https://github.com/margarets-kim",
            "followers_url": "https://api.github.com/users/margarets-kim/followers",
            "following_url": "https://api.github.com/users/margarets-kim/following{/other_user}",
            "gists_url": "https://api.github.com/users/margarets-kim/gists{/gist_id}",
            "starred_url": "https://api.github.com/users/margarets-kim/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/margarets-kim/subscriptions",
            "organizations_url": "https://api.github.com/users/margarets-kim/orgs",
            "repos_url": "https://api.github.com/users/margarets-kim/repos",
            "events_url": "https://api.github.com/users/margarets-kim/events{/privacy}",
            "received_events_url": "https://api.github.com/users/margarets-kim/received_events",
            "type": "User",
            "site_admin": false
        },
        "parents": [
            {
                "sha": "637320c780e5d5740d16bee8d046ca1f020f2206",
                "url": "https://api.github.com/repos/margarets-kim/telegram_githubell/commits/637320c780e5d5740d16bee8d046ca1f020f2206",
                "html_url": "https://github.com/margarets-kim/telegram_githubell/commit/637320c780e5d5740d16bee8d046ca1f020f2206"
            }
        ]
    }
]
```

**ì‹¤íŒ¨ì‹œ:**

```json
HTTP/1.1 200
Server: margarets.pythonanywhere.com
Content-Type: application/json
{
    [] //ë¹ˆ ë°°ì—´ ë°˜í™˜
}

```

# í…”ë ˆê·¸ë¨ ë´‡ì„ ìœ„í•œ Always on Task Polling ê¸°ëŠ¥

## í”„ë¡œê·¸ë¨ ê°œìš”

í…”ë ˆê·¸ë¨ë´‡ì€ í¬ê²Œ ë‘ê°€ì§€ë¡œ ë‚˜ë‰˜ëŠ”ë°, ê³„ì† ìœ ì €ë“¤ì˜ ë©”ì„¸ì§€ë¥¼ Listení•˜ëŠ” Pollingë°©ì‹ê³¼, Web hookê³¼ ì—°ë™ì‹œì¼œ apië¡œ ë´‡ì„ ìš´ì˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. \
ê¹ƒí—ˆë²¨ì€ ì—…ë°ì´íŠ¸ëœ ë ˆí¬ì§€í† ë¦¬ë¥¼ ë°”ë¡œ ì•Œë ¤ì•¼í•˜ê¸° ë•Œë¬¸ì— Polling ë°©ì‹ìœ¼ë¡œ êµ¬í˜„ë˜ì—ˆìœ¼ë©°,
í•´ë‹¹ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ Pythonanywhereì—ì„œ ì§€ì›í•˜ëŠ” Awlays on Task ê¸°ëŠ¥ì— ì„œë²„ êµ¬ë™ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰ì‹œì¼°ìŠµë‹ˆë‹¤. \
ë”°ë¼ì„œ í…”ë ˆê·¸ë¨ë´‡ì€ ì›¹ì•±ì´ ì¡´ì¬í•˜ì§€ì•Šìœ¼ë©° Pollingì„ í•˜ëŠ” íŒŒì´ì¬ íŒŒì¼ë¡œ êµ¬ë™ë˜ê³ ìˆìŠµë‹ˆë‹¤.
